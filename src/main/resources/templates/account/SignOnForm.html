<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="StyleSheet" href="../css/jpetstore.css" type="text/css" media="screen"/>
</head>
<body>

<header th:replace="common/Top"></header>

<div id="Content">
    <div id="BackLink">
        <a href="main">Return to Main Menu</a>
    </div>


    <div id="Catalog">
        <form action="/account/signOn" method="post" onsubmit="return sublim()">
            <p>Please enter your username and password.</p>
            <p>Username:<input type="text" name="username" ></br>
                Password:<input type="password" name="password" >
            </p>
            <p th:if="${msg!=null}" th:text="${msg}"></p>

            <p>
                Identify Code:
                <input type="text" value="" placeholder="Please enter a validation code (case sensitive)"
                      id ="text" name = "identify" />
                <input type="hidden" id = "code_user" name = "code_user" />
                <input type="hidden" id = "code_true" name = "code_true" />
                <canvas id="canvas" width="100" height="43" onclick="dj()" name = "try">
                </canvas>

                <script>
                    var show_num = [];
                    draw(show_num);
                    function dj(){
                        draw(show_num);
                    }
                    function sublim(){
                        var val=document.getElementById("text").value.toLowerCase();
                        var num = show_num.join("").toLowerCase();
                        if(val===''){
                            alert('Please enter a validation code！');
                            document.getElementById("code_user").value = "0";
                            return false;
                        }else if(val === num){
                            document.getElementById("code_user").value = "1";
                            document.getElementById(".input-val").val('');
                            draw(show_num);
                            return true;
                        }else{
                            alert('Wrong verification code!\nPlease input again！'+show_num);
                            document.getElementById("text").value='';
                            draw(show_num);
                            document.getElementById("code_user").value = "2";
                            return false;
                        }
                    }
                    function draw(show_num) {
                        var canvas_width=document.getElementById('canvas').clientWidth;
                        var canvas_height=document.getElementById('canvas').clientHeight;
                        var canvas = document.getElementById("canvas");//获取到canvas的对象，演员
                        var context = canvas.getContext("2d");//获取到canvas画图的环境，演员表演的舞台
                        canvas.width = canvas_width;
                        canvas.height = canvas_height;
                        var sCode = "A,B,C,E,F,G,H,J,K,L,M,N,P,Q,R,S,T,W,X,Y,Z,1,2,3,4,5,6,7,8,9,0,q,w,e,r,t,y,u,i,o,p,a,s,d,f,g,h,j,k,l,z,x,c,v,b,n,m";
                        var aCode = sCode.split(",");
                        var aLength = aCode.length;//获取到数组的长度

                        for (var i = 0; i <= 3; i++) {
                            var j = Math.floor(Math.random() * aLength);//获取到随机的索引值
                            var deg = Math.random() * 30 * Math.PI / 180;//产生0~30之间的随机弧度
                            var txt = aCode[j];//得到随机的一个内容
                            show_num[i] = txt;
                            var x = 10 + i * 20;//文字在canvas上的x坐标
                            var y = 20 + Math.random() * 8;//文字在canvas上的y坐标
                            context.font = "bold 23px 微软雅黑";

                            context.translate(x, y);
                            context.rotate(deg);

                            context.fillStyle = randomColor();
                            context.fillText(txt, 0, 0);

                            context.rotate(-deg);
                            context.translate(-x, -y);
                        }
                        for (var i = 0; i <= 5; i++) { //验证码上显示线条
                            context.strokeStyle = randomColor();
                            context.beginPath();
                            context.moveTo(Math.random() * canvas_width, Math.random() * canvas_height);
                            context.lineTo(Math.random() * canvas_width, Math.random() * canvas_height);
                            context.stroke();
                        }
                        for (var i = 0; i <= 30; i++) { //验证码上显示小点
                            context.strokeStyle = randomColor();
                            context.beginPath();
                            var x = Math.random() * canvas_width;
                            var y = Math.random() * canvas_height;
                            context.moveTo(x, y);
                            context.lineTo(x + 1, y + 1);
                            context.stroke();
                        }
                    }
                    function randomColor() {//得到随机的颜色值
                        var r = Math.floor(Math.random() * 256);
                        var g = Math.floor(Math.random() * 256);
                        var b = Math.floor(Math.random() * 256);
                        return "rgb(" + r + "," + g + "," + b + ")";
                    }
                </script>

            </p>

            <input type="submit" name="signon" value="Login" />
        </form>
        Need a user name and password?
        <a href="newAccountForm">Register Now!</a>
    </div>
</div>

<div id="Footer">

    <div id="PoweredBy">
        <a href="https://gitee.com/petstore_ver2/petstore">www.csu.edu.cn</a>
    </div>

    <div id="Banner">

    </div>

</div>

</body>
</html>